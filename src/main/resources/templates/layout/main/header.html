<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[[${site.configTitle}]] [[${site.configSub}]]</title>
    <link rel="stylesheet" as="style" crossorigin th:href="@{https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css}" /> <!-- 가변 다이나믹 서브셋 (fontfamily : pretendard) -->
    <link rel="shortcut icon" th:href="@{'/file/'+${site.configFabicon}}">
    <link th:href="@{/css/reset.css}" rel="stylesheet">
    <link th:href="@{/css/main.css}" rel="stylesheet">
    <script th:src="@{/js/axios.min.js}"></script>
    <link th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css}" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"/>
    <script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js}" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script th:src="@{https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js}"></script>
    <script defer th:src="@{/js/postVisitor.js}"></script>
    <script defer th:src="@{https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js}"></script>
    <link th:href="@{/js/jquery.bxslider.min.css}" rel="stylesheet" />
    <script defer th:src="@{/js/jquery.bxslider.min.js}"></script>
</head>
    <body>
    <header id="header">
        <div id="headerIn">
            <h1 class="logo">
                <a style="z-index: 2; position: relative; top: 33px;" th:href="@{/}"><img th:src="@{'/file/'+${site.configHeaderLogo}}" alt="LotteON logo"></a>
            </h1>
            <div class="utill">
                <ul>
                    <li sec:authorize="!isAuthenticated()">
                        <a th:href="@{/auth/login/view}">로그인</a>
                    </li>
                    <li sec:authorize="isAuthenticated()">
                        <a th:href="@{/auth/logout}">로그아웃</a>
                    </li>
                    <li sec:authorize="!isAuthenticated()">
                        <a th:href="@{/auth/join}">회원가입</a></li>
                    <!--                     <li sec:authorize="hasRole('customer')">-->
                    <!--                         <a th:href="@{/my/index}">마이페이지</a></li>-->
                    <!--                      마이페이지 로그인 시 확인가능 -->
                    <!--                    <li-->
                    <!--                        ><a th:href="@{/prod/cart}">장바구니</a></li>-->
                    <li
                    ><a th:href="@{/cs/index}">고객센터</a></li>
                    <li  sec:authorize="hasRole('admin')"
                    ><a th:href="@{/admin/config/index}">관리자</a></li>
                    <li  sec:authorize="hasRole('seller')"
                    ><a th:href="@{/admin/prod/products}">판매자</a></li>
                    <li  sec:authorize="isAuthenticated()"
                    ><a>이상훈님 환영합니다.</a></li>
                </ul>
            </div><!--.utill-->
            <nav class="gnb">
            </nav><!--.gnb-->
            <form th:action="@{/prod/products/search}" method="get" style="z-index: 2;" class="search2">
                <input autocomplete="off" onclick="openRelated()" type="text" id="search2" name="search" placeholder="어떤 상품을 찾으세요?">
                <input type="hidden" name="related" th:value="${related}">
                <label for="search2"></label><button style="border: none;" type="submit" class="ico_sch"><img th:src="@{/images/ico_search.png}" alt="검색하기"></button>
            </form><!--.search-->
            <div id="related-box" class="related-search-box">
                <div onclick="closeRelated()" class="close-related">X</div>
                <h4>연관검색어</h4><br>
                <div class="related-keyword"></div>
            </div>
        </div><!--.headerIn-->
        <div style="
                display: flex;
                gap: 25px;
                justify-content: flex-end;
                margin-right: 150px;
                position: relative;
                top: -11px;"
        >

            <a th:href="@{/my/index}"><img class="img-header-link" th:src="@{/images/header-my.png}" style="width: 50px; height: 50px;"></a>
            <a th:href="@{/prod/cart}"><img class="img-header-link" th:src="@{/images/header-cart.png}" style="width: 50px; height: 50px;"></a>
            <a><img class="img-header-link" th:src="@{/images/header-zzim.png}" style="width: 50px; height: 50px;"></a>
        </div>
        <div class="menu-box">
            <div>
                <span style="font-size: 1.5em; margin-right: 10px;">출석이벤트</span>
                <span style="font-size: 1.5em;">쿠폰이벤트</span>
                <span style="font-size: 1.5em;">뭐하지</span>
                <span style="font-size: 1.5em;">어렵다</span>
                <span style="font-size: 1.5em;">고객센터</span>
                <span style="font-size: 1.5em;">회사소개</span>
                <div class="search-slider">
                    <ul class="searchSlider">
                        <li>실시간 검색어 1</li>
                        <li>실시간 검색어 2</li>
                        <li>실시간 검색어 3</li>
                        <li>실시간 검색어 4</li>
                        <li>실시간 검색어 5</li>
                    </ul>
                </div>
                <div style="position: relative; top: -72px; left: 1162px; padding-top: 20px; width: 0;">
                    <img th:src="@{/images/icon_search_down.svg}">
                </div>
            </div>
        </div>
    </header><!--#header-->
</body>

<script>
    let timer;
    $(document).ready(function(){
        $('.searchSlider').bxSlider({
            mode: 'vertical',    // 세로로 슬라이드 이동
            auto: true,          // 자동 슬라이드 설정
            speed: 500,          // 슬라이드 전환 속도
            pause: 3000,         // 슬라이드 대기 시간
            controls: false,     // 이전/다음 버튼 제거
            pager: false,        // 하단 페이저 제거
            autoHover: true      // 마우스 호버 시 일시 정지
        });
    });

    function openRelated(){
        const related = document.getElementById('related-box')
        const relatedSearch = document.querySelector('.related-search-inp')
        related.style.display='block'
        relatedSearch.focus()
    }

    function closeRelated(){
        const related = document.getElementById('related-box')
        related.style.display='none'
    }

    document.getElementById("search2").addEventListener("input", function() {
        clearTimeout(timer);  // 이전 타이머를 초기화하여 중복 요청 방지

        // 새로운 타이머 설정 (2초 후에 연관 검색어 표시)
        timer = setTimeout(() => {
            const searchTerm = this.value;

            if (searchTerm) {
                // 연관 검색어 로드 함수 호출
                loadRelatedSearches(searchTerm);
            } else {
                // 입력 내용이 비어 있을 경우 연관 검색어 숨김
                document.getElementById("relatedSearches").innerHTML = "";
            }
        }, 2000); // 2초 지연 설정
    });

    async function loadRelatedSearches(searchTerm) {
        try {
            const resp = await axios.get("/search/related-search",{
                headers : {
                    "Content-Type" : "application/json"
                },
                params : {
                    'keyword' : searchTerm
                }
            })
            document.querySelector('.related-keyword').innerHTML = resp.data.map(v => {
                return `<span onclick="searchRelated(event)" data-keyword="${v}">#${v}</span>`;
            }).join('');
        } catch (e) {
            alert(e)
        }
    }

    function searchRelated(event){
        window.location.href = "/prod/products/search?search="+event.target.dataset.keyword
    }
</script>