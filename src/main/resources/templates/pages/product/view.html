<link rel="stylesheet" th:href="@{/css/product/view.css}">
<link rel="stylesheet" th:href="@{/css/basic.css}">
<header th:replace="layout/main/header.html"></header>
<script th:src="@{/js/main.js}"></script>
<main style="margin-top: 140px; gap: 0">
    <aside th:replace="layout/main/aside.html" style="margin: 0; margin-right: 30px"></aside>
    <div id="wrap">
        <!-- .aside -->
        <main id="main" style="height: auto;">
            <nav id="navi" style="width: 810px">
                <h2 class="sub_tit">상품보기</h2>
                <p class="location">
                    <span>HOME</span>
                    <span>패션·의류·뷰티</span>
                    <span>남성의류</span>
                </p>
            </nav> <!-- #navi-->
            <div class="product_info">
                <img src="https://via.placeholder.com/353x211" alt="상품 이미지" />
                <div class="product_details">
                    <form th:action="@{/prod/cart}" method="post">
                        <table class="tb1">
                            <tr>
                                <td class="td_company">
                                    <span>[[${product.getSellCompany}]]</span>
                                    <span>상품번호 : [[${product.getId}]]</span>
                                    <input type="hidden" value="2" name="prodId">
                                    <span style="
                                        cursor: pointer;
                                        color: red;
                                        border: 1px solid black;
                                        padding: 2px 4px;
                                     " data-id="9" onclick="getCustomerCoupon(event)">쿠폰 발급받기</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="prod_name">
                                    <span>[[${product.getProdName}]]</span> <br>
                                    <img src="https://via.placeholder.com/56x17" alt="별점">
                                    <a href="#">상품평보기</a>
                                </td>
                            </tr>
                            <tr>
                                <td class="price">
                                    <del>[[${#numbers.formatInteger(product.getProdPrice(), 1)}]]원&nbsp;</del>
                                    <span>[[${#numbers.formatInteger(product.getProdDiscount(), 1)}]]%&#8595;</span>
                                    <img src="https://via.placeholder.com/33x17" alt="별점">
                                    <span>무이자 할부 </span>
                                    <img src="https://via.placeholder.com/33x17" alt="별점">
                                    <span>카드 추가 혜택</span> <br>
                                    <span id="finalPrice">[[${#numbers.formatInteger(product.getTotalPrice(), 1)}]]원</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="delivery">
                                    <span>무료배송 </span>
                                    <span id="delivery-date"></span> <br>
                                    <span>본상품은 국내배송만 가능합니다.</span>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <span class="des">원산지 - 상세설명 참조</span>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <select name="options" class="prodOptions">
                                        <th:block th:each="option, i : ${options}">
                                            <th:block th:if="${!addedOptions.contains(option.optionValue)}">
                                                <option th:value="${i}">[[${option.optionValue}]]</option>
                                                <th:block th:with="addedOptions = ${addedOptions.add(option.optionValue)}"/>
                                            </th:block>
                                        </th:block>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <select name="options" class="prodOptions">
                                        <option value="4">green</option>
                                        <option value="5">blue</option>
                                        <option value="6">red</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <select name="options" class="prodOptions">
                                        <option value="7">^-^</option>
                                        <option value="8">ㅇㅅㅇ</option>
                                        <option value="9">T-T</option>
                                    </select>
                                </td>
                            </tr>
                            <tr class="count_qty">
                                <td style="float: right">
                                    <span class="qty">수량 </span>
                                    <button type="button" class="decrement">-</button> <!-- 감소 버튼 -->
                                    <input name="quantity" type="number" class="count" value="1" min="1"/>
                                    <button type="button" class="increment">+</button> <!-- 증가 버튼 -->
                                </td>
                            </tr>
                            <tr>
                                <td class="total">
                                    <span>총 상품 금액 </span>
                                    <span id="totalPrice">[[${#numbers.formatInteger(product.getTotalPrice(), 1)}]]원</span>
                                </td>
                            </tr>
                        </table> <!-- .tb1-->
                        <div class="buttons">
                            <button type="submit" class="cart">장바구니</button>
                            <button  type="button" class="btnorder"><a th:href="@{/prod/cart/direct}"> 구매하기</a></button>
                        </div> <!-- .buttons -->
                    </form>
                </div> <!-- .product_details -->
            </div> <!-- .product_info -->
            <h2 class="sub_tit2">상품보기</h2>
            <div class="detail_image">
                <img src="https://via.placeholder.com/784x111" alt="상품 상세 이미지">
            </div> <!-- .detail_image-->
            <h2 class="sub_tit3">
                상품정보 제공고시
                <span>[전자상거래에 관한 상품정보 제공에 관한 고시]항목에 의거 등록된 정보입니다.</span>
            </h2>
            <table class="tb2">
                <colgroup>
                    <col style="width: 40%;">
                    <col style="width: 60%;">
                </colgroup>
                <tr>
                    <th>상품번호</th>
                    <td>10010118412</td>
                </tr>
                <tr>
                    <th>상품상태</th>
                    <td>새상품</td>
                </tr>
                <tr>
                    <th>부가세면세여부</th>
                    <td>과세상품</td>
                </tr>
                <tr>
                    <th>영수증 발행</th>
                    <td>발행가능신용카드전표, 온라인 현금영수증</td>
                </tr>
                <tr>
                    <th>사업자 구분</th>
                    <td>통신판매업자</td>
                </tr>
                <tr>
                    <th>브랜드</th>
                    <td>블루포스</td>
                </tr>
                <tr>
                    <th>원산지</th>
                    <td>국내 생산</td>
                </tr>
            </table> <!-- tb2 -->
            <table class="tb3">
                <colgroup>
                    <col style="width: 40%;">
                    <col style="width: 60%;">
                </colgroup>
                <tr>
                    <th>제조사/수입국</th>
                    <td>상세정보 집적입력</td>
                </tr>
                <tr>
                    <th>제조국</th>
                    <td>상세정보 집적입력</td>
                </tr>
                <tr>
                    <th>취급시 주의사항</th>
                    <td>상세정보 집적입력</td>
                </tr>
                <tr>
                    <th>제조연월</th>
                    <td>상세정보 집적입력</td>
                </tr>
                <tr>
                    <th>품질보증기준</th>
                    <td>상세정보 집적입력</td>
                </tr>
                <tr>
                    <th>A/S 책임자</th>
                    <td>상세정보 집적입력</td>
                </tr>
                <tr>
                    <th>전화번호</th>
                    <td>상세정보 집적입력</td>
                </tr>
            </table> <!-- tb3 -->
            <div class="refund">
                <span>소비자가 전자상거래등에서 소비자 보호에 관한 법률 제 17조 1항 또는 제 3항에 따라 청약철회를 하고
                동법 제 18조 제 1항에 다라 청약철회한 물품을 판매자에게 반환하였음에도 불구하고 결제 대금의 환급이
                3영업일을 넘게 지연된 경우, 소비자는 전자상거래등에서 소비자보호에 관한 법률 제 18조 제 2항 및 동법 시행령 제 21조 2에
                따라 지연일수에 대하여 전상법 시행령으로 정하는 이율을 곱하여 산정한 지연이자("지연배상금")를 신청할 수 있습니다.
                아울러, 교환반품보증 및 결제대금의 환급신청은 [나의 쇼핑정보]에서 하실 수 있으며, 자세한 문의는
                개별 판매자에게 연락하여 주시기 바랍니다.</span>
            </div> <!-- .refund-->
            <h2 class="sub_tit4">상품리뷰</h2>
            <div class="cmt">
                <img src="https://via.placeholder.com/78x20"> <br>
                <span>상품명</span>
                <span>2024-10-13</span>
                <span>nickname </span><br>
                <span>후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~</span>
            </div>
            <div class="cmt">
                <img src="https://via.placeholder.com/78x20"> <br>
                <span>상품명</span>
                <span>2024-10-13</span>
                <span>nickname </span><br>
                <span>후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~</span>
            </div>
            <div class="cmt">
                <img src="https://via.placeholder.com/78x20"> <br>
                <span>상품명</span>
                <span>2024-10-13</span>
                <span>nickname </span><br>
                <span>후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~후기 남깁니다~</span>
            </div>
            <div class="page">
                <a href="#">&lt; 이전</a>
                <button>1</button>
                <button>2</button>
                <button>3</button>
                <button>4</button>
                <button>5</button>
                <a href="#">다음 &gt;</a>
            </div> <!-- page -->
        </main> <!-- #main-->
    </div>
</main>
<footer th:replace="layout/main/footer.html"></footer>
<!-- #wrap -->
<script>
    async function getCustomerCoupon(event){
        const submitData = {
            'id' : event.target.dataset.id
        }
        console.log(submitData)
        try {
            const resp = await axios.post("/prod/customer/coupon",submitData,{
                headers : {
                    "Content-Type" : "application/json"
                }
            })
            alert(resp.data)

        } catch (e) {
            alert("로그인이 필요합니다.")
            window.location.href = "/auth/login/view"
        }
    }

    // 요일명을 저장한 배열
    const days = ["일", "월", "화", "수", "목", "금", "토"];

    // 오늘을 기준으로 3일 뒤의 날짜를 계산하는 함수
    function getDeliveryDate() {
        const today = new Date();
        const deliveryDate = new Date(today);

        // 3일 뒤로 설정
        deliveryDate.setDate(today.getDate() + 3);

        // 요일 구하기
        const dayOfWeek = days[deliveryDate.getDay()];

        // 날짜 형식 만들기 (예: "7/8")
        const month = deliveryDate.getMonth() + 1; // getMonth()는 0부터 시작하므로 +1 필요
        const date = deliveryDate.getDate();

        return `(${dayOfWeek}) ${month}/${date} 도착예정`;
    }

    // HTML에 날짜 값 삽입
    document.getElementById("delivery-date").innerText = getDeliveryDate();

    // 수량 증감 버튼 구현하기
    const decrementButton = document.querySelector('.decrement');
    const incrementButton = document.querySelector('.increment');
    const countInput = document.querySelector('.count');

    // 감소 버튼 클릭 시 수량 감소
    decrementButton.addEventListener('click', () => {
        let currentValue = parseInt(countInput.value);
        if (currentValue > parseInt(countInput.min)) {
            countInput.value = currentValue - 1;
            countInput.dispatchEvent(new Event('change')); // change 이벤트 발생
        }
    });

    // 증가 버튼 클릭 시 수량 증가
    incrementButton.addEventListener('click', () => {
        let currentValue = parseInt(countInput.value);
        let maxValue = parseInt(countInput.max); // max 값을 사용하지 않으므로 따로 처리하지 않음

        // max 값이 없거나 현재 값이 max 보다 작다면 증가
        if (!maxValue || currentValue < maxValue) {
            countInput.value = currentValue + 1;
            countInput.dispatchEvent(new Event('change')); // change 이벤트 발생
        }
    });

    window.onload = function () {
        let totalPrice = document.getElementById('totalPrice');

        countInput.addEventListener('change', function (){
            let inNum = countInput.value;
            totalPrice.innerText = inNum * [[${#numbers.formatInteger(product.getTotalPrice(), 1)}]] + "원";
        });
    }
</script>