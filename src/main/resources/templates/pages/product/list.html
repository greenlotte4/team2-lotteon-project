<!-- Header 및 Font Awesome 불러오기 -->
<header th:replace="layout/main/header.html"></header>
<link rel="stylesheet" th:href="@{/css/product/list.css}">
<link rel="stylesheet" th:href="@{/css/basic.css}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"> <!-- 최신 Font Awesome -->
<script th:src="@{/js/main.js}"></script>

<script>
    window.onload = function () {
        let currentURL = window.location.href;
        let splitURL = currentURL.split('?')[1];
        let sortCode = "";
        let sortText = '';
        if (splitURL !== undefined){
            let params = new URLSearchParams(window.location.search);
            sortCode = params.get('sort');
        }
        const sortNav = document.getElementsByClassName('sort')[0];
        const aTag = sortNav.querySelectorAll('a');

        switch (sortCode) {
            case 'prodSold':
                aTag[0].classList.add('navOn');
                sortText = '판매많은순';
                break;
            case 'prodLowPrice':
                aTag[1].classList.add('navOn');
                sortText = '낮은가격순';
                break;
            case 'prodHighPrice':
                aTag[2].classList.add('navOn');
                sortText = '높은가격순';
                break;
            case 'prodScore':
                aTag[3].classList.add('navOn');
                sortText = '평점높은순';
                break;
            case 'prodReview':
                aTag[4].classList.add('navOn');
                sortText = '후기많은순';
                break;
            case 'prodRdate':
                aTag[5].classList.add('navOn');
                sortText = '최근등록순';
                break;
            default:
                sortText = '';
        }

        document.getElementById('sortText').innerText = sortText;
        renderPagination();
    }

    function sort(sortType) {
        const currentUrl = new URL(window.location.href);
        currentUrl.searchParams.set('sort', sortType);
        window.location.href = currentUrl.toString();
    }

    // 페이지네이션 함수
    function renderPagination() {
        const totalPages = 10;  // 예시 페이지 수
        const currentPage = 1;  // 예시 현재 페이지
        const paginationList = document.getElementById('pagination-list');
        paginationList.innerHTML = '';

        if (currentPage > 1) {
            const prevButton = document.createElement('li');
            prevButton.innerHTML = `<a href="#" onclick="goToPage(${currentPage - 1})">이전</a>`;
            paginationList.appendChild(prevButton);
        }

        for (let i = 1; i <= totalPages; i++) {
            const pageButton = document.createElement('li');
            pageButton.innerHTML = `<a href="#" onclick="goToPage(${i})">${i}</a>`;
            if (i === currentPage) {
                pageButton.querySelector('a').classList.add('active');
            }
            paginationList.appendChild(pageButton);
        }

        if (currentPage < totalPages) {
            const nextButton = document.createElement('li');
            nextButton.innerHTML = `<a href="#" onclick="goToPage(${currentPage + 1})">다음</a>`;
            paginationList.appendChild(nextButton);
        }
    }

    function goToPage(pageNumber) {
        const currentUrl = new URL(window.location.href);
        currentUrl.searchParams.set('page', pageNumber);
        window.location.href = currentUrl.toString();
    }
</script>

<main style="margin-top: 230px;">
    <aside th:replace="layout/main/aside.html" style="margin: 0; margin-right: 30px"></aside>
    <div id="wrap">
        <main id="main" class="content-container">
            <!-- 상품 목록 네비게이션 -->
            <nav id="navi" class="product-nav">
                <div class="title-and-location">
                    <h2 class="sub_tit">상품목록</h2>
                    <p class="location">
                        <span>[[${location.level3Name}]]</span> &gt;
                        <span>[[${location.level2Name}]]</span> &gt;
                        <span>[[${location.level1Name}]]</span>
                        <span th:if="${param.sort != null}" id="sortText"></span>
                    </p>
                </div>
            </nav>

            <!-- 정렬 탭 및 보기 옵션 -->
            <ul class="sort">
                <li><a href="#" onclick="sort('prodSold')">판매많은순</a></li>
                <li><a href="#" onclick="sort('prodLowPrice')">낮은가격순</a></li>
                <li><a href="#" onclick="sort('prodHighPrice')">높은가격순</a></li>
                <li><a href="#" onclick="sort('prodScore')">평점높은순</a></li>
                <li><a href="#" onclick="sort('prodReview')">후기많은순</a></li>
                <li><a href="#" onclick="sort('prodRdate')">최근등록순</a></li>
            </ul>
            </nav>

            <!-- 상품 목록 카드 스타일 -->
            <div class="product-list">
                <div class="product-item" th:each="product : ${products.getDtoList()}">
                    <div class="product-image">
                        <img th:src="@{'/file/'+${product.getProdListImg()}}" alt="상품 이미지">
                    </div>
                    <div class="product-info">
                        <h3 class="product-name">
                            <a th:href="@{/prod/product(prodId=${product.getId()})}">[[${product.getProdName}]]</a>
                        </h3>
                        <p class="product-summary">[[${product.getProdSummary}]]</p>
                        <div class="price-info">
                            <del class="original-price">[[${#numbers.formatInteger(product.getProdPrice(), 1)}]]원</del>
                            <span class="discount">[[${#numbers.formatInteger(product.getProdDiscount(), 1)}]]%</span>
                            <span class="current-price">[[${#numbers.formatInteger(product.getTotalPrice(), 1)}]]원</span>
                        </div>
                        <div class="delivery-info" th:if="${product.getProdDeliver() > 0}">
                            배송비 : [[${product.getProdDeliver}]]원
                        </div>
                    </div>
                    <div class="badge-container">
                        <div class="badge company">
                            <i class="fas fa-store"></i>
                            <span>[[${product.getSellCompany}]]</span>
                        </div>
                        <div class="badge customer-satisfaction">
                            <i class="fas fa-thumbs-up"></i>
                            <span>고객만족우수</span>
                        </div>
                        <div class="badge grade">
                            <i class="fas fa-star"></i>
                            <span>[[${product.getSellGrade()}]]</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pagination Controls -->
            <div class="page" th:if="${not #lists.isEmpty(products.dtoList)}">
                <th:block th:if="${products.prev}">
                    <a th:href="@{/prod/products/(pg=${products.start - 1}, cate=${cate})}" class="first"><<</a>
                </th:block>
                <th:block th:each="num:${#numbers.sequence(products.start, products.end)}">
                    <a th:href="@{/prod/products(pg=${num}, cate=${cate})}" th:class="${num == products.pg} ? 'on' : 'num'">[[${num}]]</a>
                </th:block>
                <th:block th:if="${products.next}">
                    <a th:href="@{/prod/products/(pg=${products.end + 1}, cate=${cate})}" class="first"><<</a>
                </th:block>
            </div>
        </main>
    </div>
</main>
<footer th:replace="layout/main/footer.html"></footer>
