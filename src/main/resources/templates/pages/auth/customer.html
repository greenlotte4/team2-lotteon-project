<link rel="shortcut icon" th:href="@{/images/favicon.ico}" type="image/x-icon">
<link rel="stylesheet" th:href="@{/css/auth/customer.css}">
<link rel="stylesheet" th:href="@{/css/basic.css}">
<!--<script th:src="@{/js/validation.js}"></script>-->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<header th:replace="layout/main/header.html"></header>
<main style="margin-top: 230px;">
    <div class="container">
        <h3 class="header-title">일반 회원가입</h3>
        <div class="header-gubun"></div>
        <form class="customer" action="/auth/customer" method="post">
            <input type="hidden" name="option" th:value="${isOptional}"/>
            <table class="tb1">
                <tr>
                    <th>아이디</th>
                    <td>
                        <input id="id" name="memId" type="text" placeholder="아이디 입력" required/>
                        <span class="noti_txt1">영문 , 숫자 4~12자리 설정</span>
                        <span id="resultUid" class="resultId"></span>
                    </td>
                </tr>
                <tr>
                    <th>비밀번호</th>
                    <td>
                        <input id="password" name="memPwd" type="password"  class="inputPass" placeholder="비밀번호 입력"/>
                        <span>영문, 숫자 , 특수문자 8~12자리 설정</span>
                    </td>
                </tr>
                <tr>
                    <th>비밀번호확인</th>
                    <td>
                        <input id="confirm" type="password" name="pass2" class="inputPass" placeholder="비밀번호 확인 입력"/>
                        <span class="resultPass desc" id="resultPass"></span>
                    </td>
                </tr>
            </table>
            <table class="tb2">
                <tr>
                    <th>이름</th>
                    <td>
                        <input id="name" name="custName" class="inp" placeholder="이름입력" type="text">
                        <span class="resultName"></span>
                    </td>
                </tr>
                <tr>
                    <th>성별</th>
                    <td>
                        <label for=""><input id="maleClick" value="true" type="radio" name="custGender">남</label>
                        <label for=""><input id="femaleClick" value="false" type="radio" name="custGender">여</label>
                    </td>
                </tr>
                <tr>
                    <th>이메일</th>
                    <td>
                        <input id="email" class="inp" name="custEmail" type="email" placeholder="이메일입력">
                    </td>
                    <!-- 이메일 주소가 정확한지 확인해 주세요. -->
                </tr>
                <tr>
                    <th>휴대폰</th>
                    <td>
                        <input name="custHp" id="hp" class="inp" type="text" placeholder="-없이 입력해주세요">
                    </td>
                </tr>
                <tr>
                    <th class="th-addr">주소</th>
                    <td class="td-addr">
                        <input id="addr1" name="addr1" class="addr1" type="text" placeholder="우편번호검색 클릭" >
                        <input id="addr2" name="addr2" class="addr2" type="text" placeholder="기본주소">
                        <input id="addr3" name="addr3" class="addr3" type="text" placeholder="상세주소">
                    </td>
                </tr>
            </table>
            <div class="signup">
                <button type="submit" id="signup-btn" class="signup-btn">회원가입</button>
            </div>
        </form>
    </div>
</main>
<footer th:replace="layout/main/footer.html"></footer>

<script>
    let url;
    let uidChecker = false;
    let pwdChecker = false;
    let confirmChecker = false;
    let nameChecker = false;
    let genderChecker = false;
    document.getElementById('id').addEventListener('input',(e)=>{
        delay(e,'uid')
    })
    document.getElementById('password').addEventListener('input',(e)=>{
        delay(e,'password')
    })
    document.getElementById('confirm').addEventListener('input',(e)=>{
        delay(e,'confirm')
    })
    document.getElementById('name').addEventListener('input',(e)=>{
        delay(e,'name')
    })
    document.getElementById('maleClick').addEventListener('click',()=>{
        genderChecker = true;
    })
    document.getElementById('femaleClick').addEventListener('click',()=>{
        genderChecker = true;
    })
    document.getElementById('email').addEventListener('input',(e)=>{
        delay(e,'email')
    })


    function delay(event,type){
        clearTimeout(timer);  // 이전 타이머를 초기화하여 중복 요청 방지

        // 새로운 타이머 설정 (2초 후에 연관 검색어 표시)
        timer = setTimeout(() => {
            const currentValue = event.target.value;
            if (currentValue) {
                if(type === "uid"){
                    checkUid(currentValue)
                } else if(type === "password"){
                    checkPwd(currentValue)
                } else if(type === "confirm"){
                    checkConfirm(currentValue)
                } else if(type === "name"){
                    checkName(currentValue)
                }
            }


        }, 1000);
    }


    async function checkUid(currentValue){
        const regex = /^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]{4,12}$/;
        let validation = regex.test(currentValue);
        if(!validation){
            document.getElementById('resultUid').innerText = '형식이 맞지 않습니다.'
            document.getElementById('resultUid').classList.remove('success-color')
            document.getElementById('resultUid').classList.add('error-color')
            uidChecker = false;
            return;
        }
        try {
            const resp = await axios.post(`/auth/check/uid?uid=${currentValue}`, null, {
                headers: {
                    "Content-Type": "application/json"
                }
            });
            const data = resp.data
            console.log(data)
            if(data.code==="SU"){
                uidChecker = true;
                document.getElementById('resultUid').innerText= data.msg
                document.getElementById('resultUid').classList.remove('error-color')
                document.getElementById('resultUid').classList.add('success-color')
            } else {
                uidChecker = false;
                document.getElementById('resultUid').innerText= data.msg
                document.getElementById('resultUid').classList.remove('success-color')
                document.getElementById('resultUid').classList.add('error-color')
            }
        } catch (e) {
            console.log(e)
        }
    }

    async function checkName(currentValue){
        const regex = /^[가-힣]+$/;
        let validation = regex.test(currentValue);
        if(!validation){
            document.getElementById('resultName').innerText = '형식이 맞지 않습니다.'
            document.getElementById('resultName').classList.remove('success-color')
            document.getElementById('resultName').classList.add('error-color')
            nameChecker = false;
        } else {
            document.getElementById('resultName').innerText = '형식이 일치합니다.'
            document.getElementById('resultName').classList.add('success-color')
            document.getElementById('resultName').classList.remove('error-color')
            nameChecker = true;
        }

    }

    function checkPwd(currentValue){
        const regex = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*\W)[a-zA-Z\d\W]{8,12}$/;
        let validation = regex.test(currentValue);
        if(!validation){
            document.getElementById('resultPass').innerText = '형식이 맞지 않습니다.'
            document.getElementById('resultPass').classList.remove('success-color')
            document.getElementById('resultPass').classList.add('error-color')
            pwdChecker = false;
        } else {
            document.getElementById('resultPass').innerText = '사용할 수 있는 비밀번호입니다.'
            document.getElementById('resultPass').classList.add('success-color')
            document.getElementById('resultPass').classList.remove('error-color')
            pwdChecker = true;
        }
    }

    function checkConfirm(currentValue){
        const resultPass = document.getElementById('password')
        if(resultPass.value === currentValue){
            document.getElementById('resultPass').innerText = '비밀번호 확인이 일치합니다.'
            document.getElementById('resultPass').classList.add('success-color')
            document.getElementById('resultPass').classList.remove('error-color')
            confirmChecker = true;
        } else {
            document.getElementById('resultPass').innerText = '비밀번호 확인이 일치하지않습니다.'
            document.getElementById('resultPass').classList.remove('success-color')
            document.getElementById('resultPass').classList.add('error-color')
            confirmChecker = false;
        }
    }
</script>


<!--    <script>-->
<!--        const signupBtn = document.getElementById('signup-btn');-->
<!--        const form = document.querySelector('.customer');-->
<!--    -->
<!--        // 각 입력 필드-->
<!--        const idInput = document.getElementById('id'); // 아이디-->
<!--        const passwordInput = document.getElementById('password'); // 비밀번호-->
<!--        const passwordConfirmInput = document.getElementById('confirm'); // 비밀번호 확인-->
<!--        const nameInput = document.getElementById('name'); // 이름-->
<!--        const emailInput = document.getElementById('email'); // 이메일-->
<!--        const phoneInput = document.getElementById('hp'); // 휴대폰-->
<!--        const addr1Input = document.getElementById('addr1'); // 주소1-->
<!--        const addr2Input = document.getElementById('addr2'); // 주소2-->
<!--    -->
<!--        // 유효성 검사 함수 (성별은 검사하지 않음)-->
<!--        function validateForm() {-->
<!--            const isIdValid = /^[a-zA-Z0-9]{4,12}$/.test(idInput.value); // 아이디: 영문, 숫자 4~12자리-->
<!--            const isPasswordValid = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[!@#$%^&*])[a-zA-Z\d!@#$%^&*]{8,12}$/.test(passwordInput.value); // 비밀번호: 영문, 숫자, 특수문자 8~12자리-->
<!--            const isPasswordConfirmed = passwordInput.value === passwordConfirmInput.value; // 비밀번호 확인-->
<!--            const isNameValid = nameInput.value.trim() !== ''; // 이름: 빈 값이 아닌지-->
<!--            const isEmailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value); // 이메일 형식-->
<!--            const isPhoneValid = /^\d{10,11}$/.test(phoneInput.value); // 휴대폰: 숫자만 10~11자리-->
<!--            const isAddrValid = addr1Input.value.trim() !== '' && addr2Input.value.trim() !== ''; // 주소: 주소1, 주소2 필수-->
<!--    -->
<!--            // 모든 조건이 참이면 버튼 활성화 (성별 선택 제외)-->
<!--            const isFormValid = isIdValid && isPasswordValid && isPasswordConfirmed && isNameValid && isEmailValid && isPhoneValid && isAddrValid;-->
<!--            signupBtn.disabled = !isFormValid;-->
<!--    -->
<!--            return isFormValid;-->
<!--        }-->
<!--    -->
<!--        // 입력 필드에 이벤트 리스너 추가 (입력값 변경시마다 유효성 검사)-->
<!--        form.querySelectorAll('input').forEach(input => {-->
<!--            input.addEventListener('input', validateForm);-->
<!--        });-->
<!--    -->
<!--        // 폼 제출 이벤트 처리-->
<!--        form.addEventListener('submit', function (e) {-->
<!--            if (!validateForm()) {-->
<!--                e.preventDefault(); // 유효하지 않으면 폼 제출 막기-->
<!--                alert('모든 필수 항목을 올바르게 입력해주세요.');-->
<!--            } else {-->
<!--                console.log("ddd")-->
<!--            }-->
<!--        });-->
<!--    -->
<!--    </script>-->
    
    
