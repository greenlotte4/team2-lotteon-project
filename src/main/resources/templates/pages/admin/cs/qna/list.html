<link rel="stylesheet" th:href="@{/css/admin/cs/qna/list.css}" />
<link rel="stylesheet" th:href="@{/css/basic.css}">
<body>
<header th:replace="layout/admin/header.html"></header>
<main style="margin: 0 auto; margin-bottom: 50px; margin-top: 50px;">
  <aside th:replace="layout/admin/aside.html"></aside>
  <section id="admin-product-list" class="container">
    <div id="search_input">
      <nav class="qna-nav">
        <h3>문의하기 목록</h3>
        <p>HOME > 고객센터 > <strong>문의하기</strong></p>
      </nav>
      <form action="@{'/article/' + ${cate.cateGroup} + '/' + ${cate.cateName}}" class="search">
        <input type="hidden" name="content" value="list"/>
        <input type="hidden" name="cateNo"/>
        <select class="qnaCate" name="qnaCate" onchange="firstOption()">
          <option>1차선택</option>
          <option value="user">회원</option>
          <option value="coupon">쿠폰/이벤트</option>
          <option value="order">주문/결제</option>
          <option value="delivery">배송</option>
          <option value="cancel">취소/반품/환불</option>
          <option value="travel">여행/숙박/항공</option>
          <option value="safe">안전결제</option>
        </select>
        <select class="qnaType" name="qnaType" onchange="redirectToCateType()">
          <option>2차선택</option>
          <option value="regi">가입</option>
          <option value="leave">탈퇴</option>
          <option value="info">회원정보</option>
          <option value="login">로그인</option>
        </select>
      </form>
    </div>
    <article>
      <table style="width: 100%">
        <tr>
          <th style="width: 5%"><input type="checkbox" id="selectAll" /></th>
          <th style="width: 5%">번호</th>
          <th>1차유형</th>
          <th>2차유형</th>
          <th>제목</th>
          <th>작성자</th>
          <th>작성일</th>
          <th>상태</th>
        </tr>

        <tr th:each="qna, stat : ${qnas}" th:data-id="${qna.id}">
          <td><input type="checkbox" /></td>
          <td th:text="${stat.count}">1</td>
          <td class="cate1" th:text="${qna.cate1.categoryName}">카테고리1</td>
          <td class="cate2" th:text="${qna.cate2.categoryName}" th:data-parent="${qna.cate1.categoryName}">카테고리2</td>
          <td style="text-align: left">
            <!-- 제목 클릭 시 답변 여부에 따라 view 또는 reply 페이지로 이동 -->
            <a th:href="@{'/admin/cs/qna/viewOrReply/' + ${qna.id}}" th:text="${qna.title}">문의 제목</a>
          </td>

          <!-- 작성자 표시 (작성자 열에 위치) -->
          <td>
            <span th:text="${qna.memId != null && qna.memId.toString().length() >= 2 ? qna.memId.toString().substring(0, 2) + '**' : 'N/A'}"></span>
          </td>
          <!-- 작성일 표시 (작성일 열에 위치) -->
          <td th:text="${#temporals.format(qna.rdate, 'yy.MM.dd')}">작성일</td>

          <!-- 상태 표시 (상태 열에 위치) -->
          <!-- 상태 표시 (상태 열에 위치) -->
          <td th:classappend="${qna.answer != null && !#strings.isEmpty(qna.answer) ? 'confirm answer-complete' : 'confirm'}"
              th:text="${qna.answer != null && !#strings.isEmpty(qna.answer) ? '답변완료' : '검토 중'}">검토중</td>
        </tr>
      </table>
    </article>


    <div class="button-group">
      <a class="button--delete" onclick="deleteSelected();">선택삭제</a>
    </div>
    <div class="paging">
      <a href="#" class="prev">이전</a>
      <a href="#">1</a>
      <a href="#">2</a>
      <a href="#">3</a>
      <a href="#" class="next">다음</a>
    </div>
  </section>
</main>
<footer th:replace="layout/admin/footer.html"></footer>

<script>
  const firstCategoryMap = {
    "user": "회원",
    "coupon": "쿠폰/이벤트",
    "order": "주문/결제",
    "delivery": "배송",
    "cancel": "취소/반품/환불",
    "travel": "여행/숙박/항공",
    "safe": "안전결제"
  };

  const secondCategoryMap = {
    "user": { "regi": "가입", "leave": "탈퇴", "info": "회원정보", "login": "로그인" },
    "coupon": { "lpoint": "L.POINT", "coupon": "쿠폰", "event": "이벤트/경품", "attendance": "출석체크", "gift": "사은품" },
    "order": { "orderMethod": "주문방법", "orderChange": "주문변경", "paymentMethod": "결제방법", "easyPayment": "간편결제", "giftReceive": "선물받기" },
    "delivery": { "delivery": "배송", "deliveryFee": "배송비", "deliveryMethod": "배송방법", "todayArrival": "오늘도착" },
    "cancel": { "orderCancel": "주문취소", "refundMethod": "환불방법", "cardRefund": "카드환불", "refundSchedule": "환불일정" },
    "travel": { "ecoupon": "e쿠폰", "flight": "항공", "accommodation": "숙박", "ticket": "티켓" },
    "safe": { "policyViolation": "법령 및 정책위반 상품", "ipViolation": "지적재산권침해", "serviceViolation": "서비스 이용규칙 위반" }
  };

  document.querySelector(".qnaCate").addEventListener("change", function () {
    const selectedValue = this.value;
    const select2 = document.querySelector(".qnaType");
    select2.innerHTML = '<option value="" selected disabled hidden>2차선택</option>';

    if (secondCategoryMap[selectedValue]) {
      Object.keys(secondCategoryMap[selectedValue]).forEach(key => {
        const optionText = secondCategoryMap[selectedValue][key];
        const newOption = document.createElement("option");
        newOption.value = key;
        newOption.text = optionText;
        select2.appendChild(newOption);
      });
    }
  });

  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.cate1').forEach(function (item) {
      const value = item.getAttribute('data-value');
      item.textContent = firstCategoryMap[value] || value;
    });

    document.querySelectorAll('.cate2').forEach(function (item) {
      const value = item.getAttribute('data-value');
      const parentValue = item.getAttribute('data-parent');
      item.textContent = secondCategoryMap[parentValue]?.[value] || value;
    });
  });
</script>
</body>
